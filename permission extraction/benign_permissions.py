from androguard.core.bytecodes.dvm import DalvikVMFormat
from androguard.core.analysis.analysis import VMAnalysis
from androguard.decompiler.decompiler import DecompilerDAD
from androguard.core.bytecodes.apk import APK
from androguard.core.analysis import analysis
from androguard.core.bytecodes import dvm
import glob, os

def extract_permissions(file):
    a = APK(file)
    d = DalvikVMFormat(a.get_dex())
    dx = VMAnalysis(d)
    vm = dvm.DalvikVMFormat(a.get_dex())
    vmx = analysis.uVMAnalysis(vm)
    d.set_vmanalysis(dx)
    d.set_decompiler(DecompilerDAD(d, dx))
    return a.get_permissions() 


if __name__ == "__main__":
    os.chdir("/Users/rajgaurikhemnar/Desktop/15IT133_15IT147_M2/Beningn")   
    max_apk = 400    
    apk = 1
    list_of_permissions = []
    for file in glob.glob("*"):
        if apk<=max_apk:
            permissions = extract_permissions(file)
            if permissions is None:
                pass
            else:
                for permission in permissions:
                    if permission not in list_of_permissions:
                        list_of_permissions.append(permission)
                        print(permission)
            print ("Progress: ",str((float(apk)/float(max_apk))*100.00),"%")
        apk+=1

    with open('unique_permission_in_benign1.txt','w+') as f:
      for permission in list_of_permissions:
        f.write(str(permission))
        f.write('\n')
