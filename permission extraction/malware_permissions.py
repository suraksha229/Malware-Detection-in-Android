from androguard.core.bytecodes.dvm import DalvikVMFormat
from androguard.core.analysis.analysis import VMAnalysis
from androguard.decompiler.decompiler import DecompilerDAD
from androguard.core.bytecodes.apk import APK
from androguard.core.analysis import analysis
from androguard.core.bytecodes import dvm
import math
import hashlib
import glob, os

def extract_permissions(file_path):
    a = APK(file_path)
    d = DalvikVMFormat(a.get_dex())
    dx = VMAnalysis(d)
    vm = dvm.DalvikVMFormat(a.get_dex())
    vmx = analysis.uVMAnalysis(vm)
    d.set_vmanalysis(dx)
    d.set_decompiler(DecompilerDAD(d, dx))
    return a.get_permissions()

if __name__ == "__main__":
    os.chdir("/Users/rajgaurikhemnar/Desktop/15IT133_15IT147_M2/Malware")  
    max_apk = 400    
    apk = 1
    permission_list = []
    for file in glob.glob("*"):
        if apk<=max_apk:
            permissions = extract_permissions(file)
            if permissions is None:
                pass
            else:
                for permission in permissions:
                    if permission not in permission_list:
                        permission_list.append(permission)
                        print(permission)            
        apk+=1

    with open('unique_permission_in_malware.txt','w+') as op:
      for permission in permission_list:
        op.write(str(permission))
        op.write('\n')
